<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ComuList</title>
<link rel="stylesheet" th:href="@{/main/css/common.css}">
<link rel="stylesheet" th:href="@{/main/css/slick.css}">
<link rel="stylesheet" th:href="@{/main/css/slick-theme.css}">
<link rel="stylesheet" th:href="@{/main/css/main.css}">
</head>
<body>
	<div class="wrap">
		<!-- 게시글 리스트 띄우는 테이블 -->
		<table class="list">
			<tr align="right" valign="middle">
			</tr>
			<tr align="center" valign="middle">
				<th width="8%">번호</th>
				<th>제목</th>
				<th width="15%">작성자</th>
				<th width="17%">날짜</th>
				<th width="10%">조회수</th>
			</tr>
			<tr th:if="${list != null and list.size()>0}" th:each="board : ${list}">
				<td>[[${board.boardNum}]]</td>
				<td>
					<sup class="hot" th:if="${recent_reply[boardStat.index] == 'O'}">Hot</sup>
					<sup class="new" th:if="${newly_board[boardStat.index] == 'O'}">New</sup>
				</td>
				<td>
               <th:block th:if="${session.loginUser == board.userId}">
                   <a class="get" th:href="@{'/board/' + ${board.boardnum}}">
                       <span th:text="${board.boardTitle}"></span>
                       <span class="reply_cnt" th:text="'[' + ${reply_cnt_list[boardStat.index]} + ']'"></span>
                   </a>
               </th:block>
               <th:block th:if="${session.loginUser != board.userId}">
                   <span>비밀글입니다</span>
               </th:block>
				</td>
				<td>[[${board.userId}]]</td>
				<td>
					[[${board.regDate}]]
					<th:block th:if="${board.regdate != board.updatedate}">
					(수정됨)
					</th:block>
				</td>
				<td>[[${board.readCount}]]</td>
			</tr>
			<th:block th:if="${list == null or list.size() == 0}">
				<tr>
					<td colspan="6" style="text-align: center; font-size: 20px;">등록된
						게시글이 없습니다.</td>
				</tr>
			</th:block>
		</table>
		<br>
		<!-- 페이징 처리하는 테이블 -->
		<table class="pagination">
			<tr align="center" valign="middle">
				<td>
					<a class="changePage" th:if="${pageMaker.prev}" th:href="${pageMaker.startPage-1}">&lt;</a>
					<th:block th:each="i : ${#numbers.sequence(pageMaker.startPage,pageMaker.endPage)}">
						<span class="nowPage" th:text="${i}" th:if="${pageMaker.cri.pagenum == i}"></span>
						<a class="changePage" th:href="${i}" th:text="${i}" th:unless="${pageMaker.cri.pagenum == i}"></a>
					</th:block>
					<a class="changePage" th:if="${pageMaker.next}" th:href="${pageMaker.endPage+1}">&gt;</a>
				</td>
			</tr>
		</table>
		<!-- 글쓰기 버튼 배치하는 테이블 -->
		<table>
			<tr align="right" valign="middle">
				<td>
					<a class="write" th:href="${'board/write'+pageMaker.cri.listLink}">글쓰기</a>
				</td>
			</tr>
		</table>
		<form id="searchForm" th:action="@{/board/list}">
			<div class="search_area">
				<select name="type">
					<option value="" th:selected="${pageMaker.cri.type == null}">검색</option>
					<option value="T" th:selected="${pageMaker.cri.type == 'T'}">제목</option>
					<option value="C" th:selected="${pageMaker.cri.type == 'C'}">내용</option>
					<option value="W" th:selected="${pageMaker.cri.type == 'W'}">작성자</option>
					<option value="TC" th:selected="${pageMaker.cri.type == 'TC'}">제목 또는 내용</option>
					<option value="TW" th:selected="${pageMaker.cri.type == 'TW'}">제목 또는 작성자</option>
					<option value="TCW" th:selected="${pageMaker.cri.type == 'TCW'}">제목 또는 내용 또는 작성자</option>
				</select>
				<input type="text" name="keyword" id="keyword" th:value="${pageMaker.cri.keyword}">
				<a href="#" class="button primary">검색</a>
			</div>
			<input type="hidden" value="1" name="pagenum">
			<input type="hidden" value="10" name="amount">
		</form>
	</div>
	<form name="pageForm" id="pageForm" th:action="@{/board/list}">
		<input type="hidden" name="pagenum" th:value="${pageMaker.cri.pagenum}">
		<input type="hidden" name="amount" th:value="${pageMaker.cri.amount}">
		<input type="hidden" name="type" th:value="${pageMaker.cri.type}">
		<input type="hidden" name="keyword" th:value="${pageMaker.cri.keyword}">
	</form>
	<th:block th:replace="~{layout/footer::footer}"></th:block>
	

</body>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script th:inline="javascript">
	const searchForm = $("#searchForm");
	const pageForm = $("#pageForm");
	
	$(".changePage").on("click",function(e){
		//e(이벤트)의 기본 작동 막기
		e.preventDefault();
		let pagenum = $(this).attr("href");
		pageForm.find("input[name='pagenum']").val(pagenum);
		pageForm.submit();
	});
	$(".get").on("click",function(e){
		e.preventDefault();
		let boardnum = $(this).attr("href");
		let url=/*[[@{/board/get}]]*/'';
		pageForm.append("<input type='hidden' name='boardnum' value='"+boardnum+"'>")
		pageForm.attr("action",url);
		pageForm.attr("method","get");
		pageForm.submit();
	})
	
	$("#searchForm a").on("click",sendit);
	function sendit(){
		if(!searchForm.find("option:selected").val()){
			alert("검색 기준을 선택하세요.");
			return false;
		}
		if(!$("input[name='keyword']").val()){
			alert("검색 키워드를 입력하세요.");
			return false;
		}
		searchForm.submit();
	}
</script>
</html>
